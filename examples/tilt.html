
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tilt correction &#8212; TwistPy</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-book-theme.css?digest=84ace793992934648b4de8eed757e5a2" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/style.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/sphinx-book-theme.9d8b4a8b9bb19db25eeaddc40d639ba2.js"></script>
    <link rel="canonical" href="https://twistpy.org/examples/tilt.html" />
    <link rel="shortcut icon" href="../_static/twistpy.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Contributing" href="../contributing.html" />
    <link rel="prev" title="Six-component dispersion analysis" href="dispersion.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<div class="col-12 col-md-3 bd-sidebar site-navigation " id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo_textbelow_oneaxis_adobe.png" class="logo" alt="logo">
      
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Instructions:
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../installation.html">
   Installation Instructions
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="index.html">
   Examples
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="3Cpolarization.html">
     3-C Polarization analysis and filtering in the time domain
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="3Cpolarization_timefrequency.html">
     3-C Polarization analysis and filtering in the time-frequency domain
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="marsquake.html">
     3-C Polarization analysis and filtering: Real data example using a marsquake recorded by InSight
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="six_component_wave_parameter_estimation.html">
     6-C Polarization Analysis: Time-domain wave parameter estimation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="ml_wave_type_estimation.html">
     6-C Polarization Analysis: Wave type classification
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="alaska_wave_parameter_estimation.html">
     6-C Wave parameter estimation: gulf of alaska earthquake
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="beamforming.html">
     Array Processing: Beamforming
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="stransform.html">
     S-transform
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dispersion.html">
     Six-component dispersion analysis
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Tilt correction
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../contributing.html">
   Contributing
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Reference documentation:
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../api/index.html">
   TwistPy API
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../api/generated/twistpy.polarization.TimeDomainAnalysis3C.html">
     twistpy.polarization.TimeDomainAnalysis3C
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
    <label for="toctree-checkbox-3">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/twistpy.polarization.TimeDomainAnalysis3C.filter.html">
       twistpy.polarization.TimeDomainAnalysis3C.filter
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/twistpy.polarization.TimeDomainAnalysis3C.plot.html">
       twistpy.polarization.TimeDomainAnalysis3C.plot
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/twistpy.polarization.TimeDomainAnalysis3C.polarization_analysis.html">
       twistpy.polarization.TimeDomainAnalysis3C.polarization_analysis
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/twistpy.polarization.TimeDomainAnalysis3C.save.html">
       twistpy.polarization.TimeDomainAnalysis3C.save
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../api/generated/twistpy.polarization.TimeFrequencyAnalysis3C.html">
     twistpy.polarization.TimeFrequencyAnalysis3C
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
    <label for="toctree-checkbox-4">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/twistpy.polarization.TimeFrequencyAnalysis3C.filter.html">
       twistpy.polarization.TimeFrequencyAnalysis3C.filter
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/twistpy.polarization.TimeFrequencyAnalysis3C.plot.html">
       twistpy.polarization.TimeFrequencyAnalysis3C.plot
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/twistpy.polarization.TimeFrequencyAnalysis3C.polarization_analysis.html">
       twistpy.polarization.TimeFrequencyAnalysis3C.polarization_analysis
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/twistpy.polarization.TimeFrequencyAnalysis3C.save.html">
       twistpy.polarization.TimeFrequencyAnalysis3C.save
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../api/generated/twistpy.polarization.PolarizationModel3C.html">
     twistpy.polarization.PolarizationModel3C
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
    <label for="toctree-checkbox-5">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/twistpy.polarization.PolarizationModel3C.polarization_vector.html">
       twistpy.polarization.PolarizationModel3C.polarization_vector
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../api/generated/twistpy.polarization.DispersionAnalysis.html">
     twistpy.polarization.DispersionAnalysis
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
    <label for="toctree-checkbox-6">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/twistpy.polarization.DispersionAnalysis.plot.html">
       twistpy.polarization.DispersionAnalysis.plot
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/twistpy.polarization.DispersionAnalysis.plot_baz.html">
       twistpy.polarization.DispersionAnalysis.plot_baz
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/twistpy.polarization.DispersionAnalysis.save.html">
       twistpy.polarization.DispersionAnalysis.save
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../api/generated/twistpy.polarization.TimeDomainAnalysis6C.html">
     twistpy.polarization.TimeDomainAnalysis6C
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
    <label for="toctree-checkbox-7">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/twistpy.polarization.TimeDomainAnalysis6C.classify.html">
       twistpy.polarization.TimeDomainAnalysis6C.classify
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/twistpy.polarization.TimeDomainAnalysis6C.plot.html">
       twistpy.polarization.TimeDomainAnalysis6C.plot
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/twistpy.polarization.TimeDomainAnalysis6C.polarization_analysis.html">
       twistpy.polarization.TimeDomainAnalysis6C.polarization_analysis
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/twistpy.polarization.TimeDomainAnalysis6C.save.html">
       twistpy.polarization.TimeDomainAnalysis6C.save
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../api/generated/twistpy.polarization.TimeFrequencyAnalysis6C.html">
     twistpy.polarization.TimeFrequencyAnalysis6C
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
    <label for="toctree-checkbox-8">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/twistpy.polarization.TimeFrequencyAnalysis6C.classify.html">
       twistpy.polarization.TimeFrequencyAnalysis6C.classify
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/twistpy.polarization.TimeFrequencyAnalysis6C.filter.html">
       twistpy.polarization.TimeFrequencyAnalysis6C.filter
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/twistpy.polarization.TimeFrequencyAnalysis6C.plot_classification.html">
       twistpy.polarization.TimeFrequencyAnalysis6C.plot_classification
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/twistpy.polarization.TimeFrequencyAnalysis6C.plot_wave_parameters.html">
       twistpy.polarization.TimeFrequencyAnalysis6C.plot_wave_parameters
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/twistpy.polarization.TimeFrequencyAnalysis6C.polarization_analysis.html">
       twistpy.polarization.TimeFrequencyAnalysis6C.polarization_analysis
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/twistpy.polarization.TimeFrequencyAnalysis6C.save.html">
       twistpy.polarization.TimeFrequencyAnalysis6C.save
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../api/generated/twistpy.polarization.EstimatorConfiguration.html">
     twistpy.polarization.EstimatorConfiguration
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
    <label for="toctree-checkbox-9">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/twistpy.polarization.EstimatorConfiguration.compute_steering_vectors.html">
       twistpy.polarization.EstimatorConfiguration.compute_steering_vectors
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../api/generated/twistpy.polarization.SupportVectorMachine.html">
     twistpy.polarization.SupportVectorMachine
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
    <label for="toctree-checkbox-10">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/twistpy.polarization.SupportVectorMachine.load_model.html">
       twistpy.polarization.SupportVectorMachine.load_model
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/twistpy.polarization.SupportVectorMachine.train.html">
       twistpy.polarization.SupportVectorMachine.train
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../api/generated/twistpy.polarization.PolarizationModel6C.html">
     twistpy.polarization.PolarizationModel6C
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
    <label for="toctree-checkbox-11">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/twistpy.polarization.PolarizationModel6C.polarization_vector.html">
       twistpy.polarization.PolarizationModel6C.polarization_vector
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/generated/twistpy.tilt.correction.remove_tilt.html">
     twistpy.tilt.correction.remove_tilt
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/generated/twistpy.tilt.correction.transfer_function.html">
     twistpy.tilt.correction.transfer_function
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../api/generated/twistpy.array_processing.BeamformingArray.html">
     twistpy.array_processing.BeamformingArray
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
    <label for="toctree-checkbox-12">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/twistpy.array_processing.BeamformingArray.add_data.html">
       twistpy.array_processing.BeamformingArray.add_data
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/twistpy.array_processing.BeamformingArray.beamforming.html">
       twistpy.array_processing.BeamformingArray.beamforming
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/twistpy.array_processing.BeamformingArray.compute_steering_vectors.html">
       twistpy.array_processing.BeamformingArray.compute_steering_vectors
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/generated/twistpy.utils.stransform.html">
     twistpy.utils.stransform
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/generated/twistpy.utils.istransform.html">
     twistpy.utils.istransform
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/generated/twistpy.utils.load_analysis.html">
     twistpy.utils.load_analysis
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  References:
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../references.html">
   Relevant Publications
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../contributors.html">
   Contributors
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../contact.html">
   Contact
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../acknowledgments.html">
   Acknowledgments
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
</div>

</div>


          


          
<!-- This is an invisible pixel that we watch to see if we've scrolled. -->
<div class="sbt-scroll-pixel-helper"></div>
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            <div class="topbar-left">
                
                <label class="nav-toggle-button" for="__navigation">
                    <div class="visually-hidden">Toggle navigation</div>
                    <i class="fas fa-bars"></i>
                </label>
                
            </div>
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/examples/tilt.rst.txt"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.rst</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/solldavid/TwistPy"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#frequency-domain-coh">
   frequency domain (coh)
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plots">
   Plots
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Tilt correction</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#frequency-domain-coh">
   frequency domain (coh)
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plots">
   Plots
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-examples-tilt-py"><span class="std std-ref">here</span></a>
to download the full example code</p>
</div>
<div class="sphx-glr-example-title section" id="tilt-correction">
<span id="sphx-glr-examples-tilt-py"></span><h1>Tilt correction<a class="headerlink" href="#tilt-correction" title="Permalink to this headline">Â¶</a></h1>
<p>This script implements a simple example for dynamic tilt correction. It
reproduces the tilt table experiment from Bernauer et al (2020) based on the
method by Crawford and Webb (2000).</p>
<p>The example demonstrates the different correction variants provided by <a class="reference internal" href="../api/generated/twistpy.tilt.correction.remove_tilt.html#twistpy.tilt.correction.remove_tilt" title="twistpy.tilt.correction.remove_tilt"><code class="xref py py-func docutils literal notranslate"><span class="pre">twistpy.tilt.correction.remove_tilt</span></code></a>.</p>
<p>The example data required by this script is included in the TwistPy example_data
collection.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <a href="https://matplotlib.org/stable/api/matplotlib_configuration_api.html#matplotlib.rc" title="matplotlib.rc" class="sphx-glr-backref-module-matplotlib sphx-glr-backref-type-py-function"><span class="n">rc</span></a>
<span class="kn">from</span> <span class="nn">matplotlib.transforms</span> <span class="kn">import</span> <span class="n">Bbox</span><span class="p">,</span> <a href="https://matplotlib.org/stable/api/transformations.html#matplotlib.transforms.TransformedBbox" title="matplotlib.transforms.TransformedBbox" class="sphx-glr-backref-module-matplotlib-transforms sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">TransformedBbox</span></a><span class="p">,</span> <a href="https://matplotlib.org/stable/api/transformations.html#matplotlib.transforms.blended_transform_factory" title="matplotlib.transforms.blended_transform_factory" class="sphx-glr-backref-module-matplotlib-transforms sphx-glr-backref-type-py-function"><span class="n">blended_transform_factory</span></a>
<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1.inset_locator</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">BboxPatch</span><span class="p">,</span>
    <span class="n">BboxConnector</span><span class="p">,</span>
    <span class="n">BboxConnectorPatch</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">obspy</span> <span class="kn">import</span> <span class="n">Stream</span><span class="p">,</span> <span class="n">Trace</span>

<span class="kn">from</span> <span class="nn">twistpy.tilt.correction</span> <span class="kn">import</span> <a href="../api/generated/twistpy.tilt.correction.remove_tilt.html#twistpy.tilt.correction.remove_tilt" title="twistpy.tilt.correction.remove_tilt" class="sphx-glr-backref-module-twistpy-tilt-correction sphx-glr-backref-type-py-function"><span class="n">remove_tilt</span></a>
<span class="kn">from</span> <span class="nn">twistpy.tilt.util</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">get_data</span><span class="p">,</span>
    <span class="n">trigger</span><span class="p">,</span>
    <span class="n">calc_residual_disp</span><span class="p">,</span>
    <span class="n">get_angle</span><span class="p">,</span>
    <span class="n">theo_resid_disp</span><span class="p">,</span>
    <span class="n">calc_height_of_mass</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>This script implements a simple example for dynamic tilt correction. It
reproduces the # tilt table experiment from Bernauer et al. 2020 (SRL).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data_dir</span> <span class="o">=</span> <span class="s2">&quot;../example_data/tilt_correction&quot;</span>
</pre></div>
</div>
<p>This method is needed for the matplotlib zoom effect</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">connect_bbox</span><span class="p">(</span>
    <span class="n">bbox1</span><span class="p">,</span> <span class="n">bbox2</span><span class="p">,</span> <span class="n">loc1a</span><span class="p">,</span> <span class="n">loc2a</span><span class="p">,</span> <span class="n">loc1b</span><span class="p">,</span> <span class="n">loc2b</span><span class="p">,</span> <span class="n">prop_lines</span><span class="p">,</span> <span class="n">prop_patches</span><span class="o">=</span><span class="kc">None</span>
<span class="p">):</span>
    <span class="k">if</span> <span class="n">prop_patches</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">prop_patches</span> <span class="o">=</span> <span class="p">{</span>
            <span class="o">**</span><span class="n">prop_lines</span><span class="p">,</span>
            <span class="s2">&quot;alpha&quot;</span><span class="p">:</span> <span class="n">prop_lines</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="n">c1</span> <span class="o">=</span> <span class="n">BboxConnector</span><span class="p">(</span><span class="n">bbox1</span><span class="p">,</span> <span class="n">bbox2</span><span class="p">,</span> <span class="n">loc1</span><span class="o">=</span><span class="n">loc1a</span><span class="p">,</span> <span class="n">loc2</span><span class="o">=</span><span class="n">loc2a</span><span class="p">,</span> <span class="o">**</span><span class="n">prop_lines</span><span class="p">)</span>
    <span class="n">c1</span><span class="o">.</span><span class="n">set_clip_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">c2</span> <span class="o">=</span> <span class="n">BboxConnector</span><span class="p">(</span><span class="n">bbox1</span><span class="p">,</span> <span class="n">bbox2</span><span class="p">,</span> <span class="n">loc1</span><span class="o">=</span><span class="n">loc1b</span><span class="p">,</span> <span class="n">loc2</span><span class="o">=</span><span class="n">loc2b</span><span class="p">,</span> <span class="o">**</span><span class="n">prop_lines</span><span class="p">)</span>
    <span class="n">c2</span><span class="o">.</span><span class="n">set_clip_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">bbox_patch1</span> <span class="o">=</span> <span class="n">BboxPatch</span><span class="p">(</span><span class="n">bbox1</span><span class="p">,</span> <span class="o">**</span><span class="n">prop_patches</span><span class="p">)</span>
    <span class="n">bbox_patch2</span> <span class="o">=</span> <span class="n">BboxPatch</span><span class="p">(</span><span class="n">bbox2</span><span class="p">,</span> <span class="o">**</span><span class="n">prop_patches</span><span class="p">)</span>

    <span class="n">p</span> <span class="o">=</span> <span class="n">BboxConnectorPatch</span><span class="p">(</span>
        <span class="n">bbox1</span><span class="p">,</span> <span class="n">bbox2</span><span class="p">,</span> <span class="n">loc1a</span><span class="o">=</span><span class="n">loc1a</span><span class="p">,</span> <span class="n">loc2a</span><span class="o">=</span><span class="n">loc2a</span><span class="p">,</span> <span class="n">loc1b</span><span class="o">=</span><span class="n">loc1b</span><span class="p">,</span> <span class="n">loc2b</span><span class="o">=</span><span class="n">loc2b</span><span class="p">,</span> <span class="o">**</span><span class="n">prop_patches</span>
    <span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">set_clip_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">bbox_patch1</span><span class="p">,</span> <span class="n">bbox_patch2</span><span class="p">,</span> <span class="n">p</span>
</pre></div>
</div>
<p>This method is needed for the matplotlib zoom effect</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">zoom_effect01</span><span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Connect *ax1* and *ax2*. The *xmin*-to-*xmax* range in both axes will</span>
<span class="sd">    be marked.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ax1</span>
<span class="sd">        The main axes.</span>
<span class="sd">    ax2</span>
<span class="sd">        The zoomed axes.</span>
<span class="sd">    xmin, xmax</span>
<span class="sd">        The limits of the colored area in both plot axes.</span>
<span class="sd">    **kwargs</span>
<span class="sd">        Arguments passed to the patch constructor.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">trans1</span> <span class="o">=</span> <a href="https://matplotlib.org/stable/api/transformations.html#matplotlib.transforms.blended_transform_factory" title="matplotlib.transforms.blended_transform_factory" class="sphx-glr-backref-module-matplotlib-transforms sphx-glr-backref-type-py-function"><span class="n">blended_transform_factory</span></a><span class="p">(</span><span class="n">ax1</span><span class="o">.</span><span class="n">transData</span><span class="p">,</span> <span class="n">ax1</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
    <span class="n">trans2</span> <span class="o">=</span> <a href="https://matplotlib.org/stable/api/transformations.html#matplotlib.transforms.blended_transform_factory" title="matplotlib.transforms.blended_transform_factory" class="sphx-glr-backref-module-matplotlib-transforms sphx-glr-backref-type-py-function"><span class="n">blended_transform_factory</span></a><span class="p">(</span><span class="n">ax2</span><span class="o">.</span><span class="n">transData</span><span class="p">,</span> <span class="n">ax2</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>

    <span class="n">bbox</span> <span class="o">=</span> <a href="https://matplotlib.org/stable/api/transformations.html#matplotlib.transforms.Bbox.from_extents" title="matplotlib.transforms.Bbox.from_extents" class="sphx-glr-backref-module-matplotlib-transforms-Bbox sphx-glr-backref-type-py-method"><span class="n">Bbox</span><span class="o">.</span><span class="n">from_extents</span></a><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">mybbox1</span> <span class="o">=</span> <a href="https://matplotlib.org/stable/api/transformations.html#matplotlib.transforms.TransformedBbox" title="matplotlib.transforms.TransformedBbox" class="sphx-glr-backref-module-matplotlib-transforms sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">TransformedBbox</span></a><span class="p">(</span><span class="n">bbox</span><span class="p">,</span> <span class="n">trans1</span><span class="p">)</span>
    <span class="n">mybbox2</span> <span class="o">=</span> <a href="https://matplotlib.org/stable/api/transformations.html#matplotlib.transforms.TransformedBbox" title="matplotlib.transforms.TransformedBbox" class="sphx-glr-backref-module-matplotlib-transforms sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">TransformedBbox</span></a><span class="p">(</span><span class="n">bbox</span><span class="p">,</span> <span class="n">trans2</span><span class="p">)</span>

    <span class="n">prop_patches</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span> <span class="s2">&quot;ec&quot;</span><span class="p">:</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="s2">&quot;alpha&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">}</span>

    <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">bbox_patch1</span><span class="p">,</span> <span class="n">bbox_patch2</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">connect_bbox</span><span class="p">(</span>
        <span class="n">mybbox1</span><span class="p">,</span>
        <span class="n">mybbox2</span><span class="p">,</span>
        <span class="n">loc1a</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">loc2a</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">loc1b</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
        <span class="n">loc2b</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">prop_lines</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="n">prop_patches</span><span class="o">=</span><span class="n">prop_patches</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">bbox_patch1</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">bbox_patch2</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">c1</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">c2</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">bbox_patch1</span><span class="p">,</span> <span class="n">bbox_patch2</span><span class="p">,</span> <span class="n">p</span>
</pre></div>
</div>
<p>This method is needed for the matplotlib zoom effect</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">zoom_effect02</span><span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ax1 : the main axes</span>
<span class="sd">    ax1 : the zoomed axes</span>
<span class="sd">    Similar to zoom_effect01.  The xmin &amp; xmax will be taken from the</span>
<span class="sd">    ax1.viewLim.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">tt</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">transScale</span> <span class="o">+</span> <span class="p">(</span><span class="n">ax1</span><span class="o">.</span><span class="n">transLimits</span> <span class="o">+</span> <span class="n">ax2</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
    <span class="n">trans</span> <span class="o">=</span> <a href="https://matplotlib.org/stable/api/transformations.html#matplotlib.transforms.blended_transform_factory" title="matplotlib.transforms.blended_transform_factory" class="sphx-glr-backref-module-matplotlib-transforms sphx-glr-backref-type-py-function"><span class="n">blended_transform_factory</span></a><span class="p">(</span><span class="n">ax2</span><span class="o">.</span><span class="n">transData</span><span class="p">,</span> <span class="n">tt</span><span class="p">)</span>

    <span class="n">mybbox1</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">bbox</span>
    <span class="n">mybbox2</span> <span class="o">=</span> <a href="https://matplotlib.org/stable/api/transformations.html#matplotlib.transforms.TransformedBbox" title="matplotlib.transforms.TransformedBbox" class="sphx-glr-backref-module-matplotlib-transforms sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">TransformedBbox</span></a><span class="p">(</span><span class="n">ax1</span><span class="o">.</span><span class="n">viewLim</span><span class="p">,</span> <span class="n">trans</span><span class="p">)</span>

    <span class="n">prop_patches</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span> <span class="s2">&quot;ec&quot;</span><span class="p">:</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="s2">&quot;alpha&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">}</span>

    <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">bbox_patch1</span><span class="p">,</span> <span class="n">bbox_patch2</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">connect_bbox</span><span class="p">(</span>
        <span class="n">mybbox1</span><span class="p">,</span>
        <span class="n">mybbox2</span><span class="p">,</span>
        <span class="n">loc1a</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">loc2a</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">loc1b</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">loc2b</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
        <span class="n">prop_lines</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="n">prop_patches</span><span class="o">=</span><span class="n">prop_patches</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">bbox_patch1</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">bbox_patch2</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">c1</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">c2</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">bbox_patch1</span><span class="p">,</span> <span class="n">bbox_patch2</span><span class="p">,</span> <span class="n">p</span>
</pre></div>
</div>
<dl class="simple">
<dt>TEST     - tilt table -        #</dt><dd><ul class="simple">
<li><p>high gain, 1/6 -    #</p></li>
<li><p>166.7mum -          #</p></li>
<li><p>21 steps -          #</p></li>
</ul>
</dd>
</dl>
<p>Get raw data from</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">stream1</span> <span class="o">=</span> <a href="https://docs.python.org/3/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s2">&quot;XX.TC120..HH*.D.2018.343&quot;</span><span class="p">)</span>
<span class="n">stream2</span> <span class="o">=</span> <a href="https://docs.python.org/3/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s2">&quot;XX.BS1..HJ*.D.2018.343&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>at the time</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">utctime</span> <span class="o">=</span> <span class="s2">&quot;2018-12-09T19:48:48.6&quot;</span>
</pre></div>
</div>
<p>how many seconds of data do you want to read in?</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">duration</span> <span class="o">=</span> <span class="mi">120</span>
</pre></div>
</div>
<p>Define the seismometer and rotational sensor stream identifiers</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">correct_channel</span> <span class="o">=</span> <span class="s2">&quot;HH*&quot;</span>
<span class="n">input_channel</span> <span class="o">=</span> <span class="s2">&quot;HJ*&quot;</span>
</pre></div>
</div>
<p>Set some trigger parameters and start to search for steps from second</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">S</span> <span class="o">=</span> <span class="mf">18.0</span>
<span class="c1"># no steps after second</span>
<span class="n">E</span> <span class="o">=</span> <span class="mf">91.0</span>
</pre></div>
</div>
<p>correct the trigger onset by a constant offset, which was determined visually</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">c_on</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.075</span>
<span class="n">c_off</span> <span class="o">=</span> <span class="mf">0.49</span>
</pre></div>
</div>
<p>define the zoom windows for the plots</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">zoom00</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">zoom01</span> <span class="o">=</span> <span class="mf">110.0</span>
<span class="n">zoom0</span> <span class="o">=</span> <span class="mf">53.6</span>
<span class="n">zoom1</span> <span class="o">=</span> <span class="mf">55.6</span>
</pre></div>
</div>
<p>Geometrical parameters of the experiment
horizontal distance of center of seismometer to axis of rotation in m</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">l</span> <span class="o">=</span> <span class="mf">0.32</span>  <span class="c1"># noqa</span>
<span class="c1"># vertical distance of bottom of seismometer to axis of rotation in m</span>
<span class="n">dh</span> <span class="o">=</span> <span class="mf">0.047</span>
</pre></div>
</div>
<p>define the source stream (ss) and the receiver stream (sr) channels</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ch_sr</span> <span class="o">=</span> <span class="s2">&quot;HHN&quot;</span>
<span class="n">ch_ss</span> <span class="o">=</span> <span class="s2">&quot;HJE&quot;</span>
</pre></div>
</div>
<p>get the data</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vel_orig</span><span class="p">,</span> <span class="n">rr_orig</span> <span class="o">=</span> <span class="n">get_data</span><span class="p">(</span>
    <span class="n">stream1</span><span class="p">,</span>
    <span class="n">stream2</span><span class="p">,</span>
    <span class="n">utctime</span><span class="p">,</span>
    <span class="n">duration</span><span class="p">,</span>
    <span class="n">correct_channel</span><span class="p">,</span>
    <span class="n">input_channel</span><span class="p">,</span>
    <a href="https://docs.python.org/3/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s2">&quot;station.xml&quot;</span><span class="p">),</span>
    <span class="n">ch_sr</span><span class="p">,</span>
    <span class="n">ch_ss</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>make four independent streams containing tilt contaminated acceleration
recordings:
(1) the original tilt contaminated stream for later comparisons
(2) the stream that will be treated with the frequency domain (CaW)
correction
(3) the stream that will be treated with the frequency domain (coh)
correction
(4) the stream that will be treated with the time domain correction</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sr</span> <span class="o">=</span> <span class="n">vel_orig</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">sr</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="s2">&quot;bandpass&quot;</span><span class="p">,</span> <span class="n">freqmin</span><span class="o">=</span><span class="mf">0.03</span><span class="p">,</span> <span class="n">freqmax</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">corners</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">zerophase</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">acc_orig</span> <span class="o">=</span> <span class="n">sr</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">acc_orig</span><span class="o">.</span><span class="n">differentiate</span><span class="p">()</span>  <span class="c1"># original acc recording (reciever)</span>

<span class="n">rf1</span> <span class="o">=</span> <span class="n">sr</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">rf2</span> <span class="o">=</span> <span class="n">sr</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">rt</span> <span class="o">=</span> <span class="n">sr</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">rf1</span><span class="o">.</span><span class="n">differentiate</span><span class="p">()</span>  <span class="c1"># reciever for freq-domain (coh) analysis (acc recording)</span>
<span class="n">rf2</span><span class="o">.</span><span class="n">differentiate</span><span class="p">()</span>  <span class="c1"># reciever for freq-domain (plain) analysis (acc recording)  # noqa</span>
<span class="n">rt</span><span class="o">.</span><span class="n">differentiate</span><span class="p">()</span>  <span class="c1"># reciever for time-domain analysis (acc recording)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;obspy.core.stream.Stream object at 0x7fe778978050&gt;
</pre></div>
</div>
<p>make two independent streams containing the tilt angle recording
(1) original tilt angle recording for later comparisons
(2) tilt angle recording as the source for the corrections</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ss</span> <span class="o">=</span> <span class="n">rr_orig</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">ss</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="s2">&quot;bandpass&quot;</span><span class="p">,</span> <span class="n">freqmin</span><span class="o">=</span><span class="mf">0.03</span><span class="p">,</span> <span class="n">freqmax</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">corners</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">zerophase</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">ra_orig</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">ra_orig</span><span class="o">.</span><span class="n">integrate</span><span class="p">()</span>  <span class="c1"># original rotation angle recording (source)</span>

<span class="n">ts</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">ts</span><span class="o">.</span><span class="n">integrate</span><span class="p">()</span>  <span class="c1"># source for correction (tilt angle recording)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;obspy.core.stream.Stream object at 0x7fe778a7aa50&gt;
</pre></div>
</div>
<p>In this example, we are treating the North-axis of acceleration and the
East-axis of rotation angle. Thus, for a positive rotation, the tilt induced
accelertion shows into the same direction as the horizontal ground movement
accelertion. We account for this in the subsequent analysis by setting</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">par</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p>Now, lets do the tilt corrections!</p>
<div class="section" id="frequency-domain-coh">
<h2>frequency domain (coh)<a class="headerlink" href="#frequency-domain-coh" title="Permalink to this headline">Â¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fmin</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">fmax</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">acc_corr_freq1_data</span> <span class="o">=</span> <a href="../api/generated/twistpy.tilt.correction.remove_tilt.html#twistpy.tilt.correction.remove_tilt" title="twistpy.tilt.correction.remove_tilt" class="sphx-glr-backref-module-twistpy-tilt-correction sphx-glr-backref-type-py-function"><span class="n">remove_tilt</span></a><span class="p">(</span>
    <span class="n">rf1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
    <span class="n">ts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
    <span class="n">rf1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">delta</span><span class="p">,</span>
    <span class="n">fmin</span><span class="p">,</span>
    <span class="n">fmax</span><span class="p">,</span>
    <span class="n">parallel</span><span class="o">=</span><span class="n">par</span><span class="p">,</span>
    <span class="n">smooth</span><span class="o">=</span><span class="mf">100.0</span> <span class="o">/</span> <span class="mf">164.0</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;coh&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">acc_corr_freq1</span> <span class="o">=</span> <span class="n">acc_orig</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">acc_corr_freq1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">acc_corr_freq1_data</span>

<span class="n">acc_corr_freq1</span><span class="o">.</span><span class="n">detrend</span><span class="p">(</span><span class="s2">&quot;demean&quot;</span><span class="p">)</span>

<span class="n">vel_corr_freq1</span> <span class="o">=</span> <span class="n">acc_corr_freq1</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">vel_corr_freq1</span><span class="o">.</span><span class="n">integrate</span><span class="p">()</span>

<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># frequency domain (plain)</span>
<span class="c1"># -----------------------------------------------------------------------------</span>

<span class="n">fmin</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">fmax</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">acc_corr_freq2_data</span> <span class="o">=</span> <a href="../api/generated/twistpy.tilt.correction.remove_tilt.html#twistpy.tilt.correction.remove_tilt" title="twistpy.tilt.correction.remove_tilt" class="sphx-glr-backref-module-twistpy-tilt-correction sphx-glr-backref-type-py-function"><span class="n">remove_tilt</span></a><span class="p">(</span>
    <span class="n">rf2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
    <span class="n">ts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
    <span class="n">rf2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">delta</span><span class="p">,</span>
    <span class="n">fmin</span><span class="p">,</span>
    <span class="n">fmax</span><span class="p">,</span>
    <span class="n">parallel</span><span class="o">=</span><span class="n">par</span><span class="p">,</span>
    <span class="n">smooth</span><span class="o">=</span><span class="mf">100.0</span> <span class="o">/</span> <span class="mf">164.0</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;freq&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">acc_corr_freq2</span> <span class="o">=</span> <span class="n">acc_orig</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">acc_corr_freq2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">acc_corr_freq2_data</span>

<span class="n">acc_corr_freq2</span><span class="o">.</span><span class="n">detrend</span><span class="p">(</span><span class="s2">&quot;demean&quot;</span><span class="p">)</span>

<span class="n">vel_corr_freq2</span> <span class="o">=</span> <span class="n">acc_corr_freq2</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">vel_corr_freq2</span><span class="o">.</span><span class="n">integrate</span><span class="p">()</span>

<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># time domain</span>
<span class="c1"># -----------------------------------------------------------------------------</span>

<span class="n">acc_corr_time_data</span> <span class="o">=</span> <a href="../api/generated/twistpy.tilt.correction.remove_tilt.html#twistpy.tilt.correction.remove_tilt" title="twistpy.tilt.correction.remove_tilt" class="sphx-glr-backref-module-twistpy-tilt-correction sphx-glr-backref-type-py-function"><span class="n">remove_tilt</span></a><span class="p">(</span>
    <span class="n">rt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">ts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">rt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">delta</span><span class="p">,</span> <span class="n">parallel</span><span class="o">=</span><span class="n">par</span>
<span class="p">)</span>
<span class="n">acc_corr_time</span> <span class="o">=</span> <span class="n">acc_orig</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">acc_corr_time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">acc_corr_time_data</span>

<span class="n">acc_corr_time</span><span class="o">.</span><span class="n">detrend</span><span class="p">(</span><span class="s2">&quot;demean&quot;</span><span class="p">)</span>

<span class="n">vel_corr_time</span> <span class="o">=</span> <span class="n">acc_corr_time</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">vel_corr_time</span><span class="o">.</span><span class="n">integrate</span><span class="p">()</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;obspy.core.stream.Stream object at 0x7fe769608610&gt;
</pre></div>
</div>
<p>Due to the very well known geometry in the tilt table experiment, we can play
some games e.g. try to locate the proof mass of the seismometer and compare
the output of our corrections with theortically expercted movements.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">on</span><span class="p">,</span> <span class="n">off</span> <span class="o">=</span> <span class="n">trigger</span><span class="p">(</span><span class="n">rr_orig</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">140</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="n">c_on</span><span class="p">,</span> <span class="n">c_off</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># define a time axis</span>
<span class="n">sec</span> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.arange.html#numpy.arange" title="numpy.arange" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">arange</span></a><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">acc_orig</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">acc_orig</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">sampling_rate</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">on</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">off</span><span class="p">))</span>

<span class="c1"># calculate residual displacement</span>

<span class="n">alpha</span> <span class="o">=</span> <span class="n">get_angle</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">on</span><span class="p">,</span> <span class="n">off</span><span class="p">)</span>  <span class="c1"># angle steps recorded by BS1</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>21
21
</pre></div>
</div>
<p>in theory: according to Steffen position of the mass is approximately at the
middle of the housing</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">h_m</span> <span class="o">=</span> <span class="mf">0.0575</span>  <span class="c1"># m</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">h_m</span>  <span class="c1"># m</span>

<span class="n">std_m</span> <span class="o">=</span> <span class="mf">0.01</span>

<span class="n">r</span><span class="p">,</span> <span class="n">centr</span> <span class="o">=</span> <span class="n">theo_resid_disp</span><span class="p">(</span><span class="n">ts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">dh</span><span class="p">,</span> <span class="n">rr_orig</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="n">trr</span> <span class="o">=</span> <span class="n">Stream</span><span class="p">(</span><span class="n">traces</span><span class="o">=</span><span class="n">Trace</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">ts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">stats</span><span class="p">))</span>
<span class="n">trr</span><span class="o">.</span><span class="n">differentiate</span><span class="p">()</span>
<span class="n">trr_a</span> <span class="o">=</span> <span class="n">trr</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">trr_a</span><span class="o">.</span><span class="n">differentiate</span><span class="p">()</span>
<span class="n">time_ttheo</span><span class="p">,</span> <span class="n">disp_ttheo</span><span class="p">,</span> <span class="n">mean_disp_ttheo</span><span class="p">,</span> <span class="n">sigma_ttheo</span> <span class="o">=</span> <span class="n">calc_residual_disp</span><span class="p">(</span>
    <span class="n">trr</span><span class="p">,</span> <span class="n">on</span><span class="p">,</span> <span class="n">off</span><span class="p">,</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.zeros.html#numpy.zeros" title="numpy.zeros" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">zeros</span></a><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">)),</span> <span class="n">theo</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="n">h_ttheo</span><span class="p">,</span> <span class="n">std_ttheo</span> <span class="o">=</span> <span class="n">calc_height_of_mass</span><span class="p">(</span><span class="n">mean_disp_ttheo</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">dh</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>

<span class="n">tcentr</span> <span class="o">=</span> <span class="n">Stream</span><span class="p">(</span><span class="n">traces</span><span class="o">=</span><span class="n">Trace</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">centr</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">ts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">stats</span><span class="p">))</span>
<span class="n">tcentr</span><span class="o">.</span><span class="n">detrend</span><span class="p">(</span><span class="s2">&quot;demean&quot;</span><span class="p">)</span>
<span class="n">tcentr</span><span class="o">.</span><span class="n">detrend</span><span class="p">(</span><span class="s2">&quot;linear&quot;</span><span class="p">)</span>
<span class="n">tcentr</span><span class="o">.</span><span class="n">integrate</span><span class="p">()</span>
<span class="n">tcentr</span><span class="o">.</span><span class="n">detrend</span><span class="p">(</span><span class="s2">&quot;demean&quot;</span><span class="p">)</span>
<span class="n">tcentr</span><span class="o">.</span><span class="n">detrend</span><span class="p">(</span><span class="s2">&quot;linear&quot;</span><span class="p">)</span>
<span class="n">tcentr</span><span class="o">.</span><span class="n">integrate</span><span class="p">()</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;obspy.core.stream.Stream object at 0x7fe76960aa90&gt;
</pre></div>
</div>
<p>correct for residual displacement in time domain</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">acc_corr_time2</span> <span class="o">=</span> <span class="n">acc_corr_time</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">acc_corr_time2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">acc_corr_time2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">-</span> <span class="n">trr_a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>

<span class="n">vel_corr_time2</span> <span class="o">=</span> <span class="n">acc_corr_time2</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">vel_corr_time2</span><span class="o">.</span><span class="n">integrate</span><span class="p">()</span>

<span class="n">tr1_vel</span> <span class="o">=</span> <span class="n">vel_corr_freq1</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">tr2_vel</span> <span class="o">=</span> <span class="n">vel_corr_freq2</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">tt_vel</span> <span class="o">=</span> <span class="n">vel_corr_time</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">tt2_vel</span> <span class="o">=</span> <span class="n">vel_corr_time2</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">tr1_new</span> <span class="o">=</span> <span class="n">vel_corr_freq1</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">tr2_new</span> <span class="o">=</span> <span class="n">vel_corr_freq2</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">tt_new</span> <span class="o">=</span> <span class="n">vel_corr_time</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">tt2_new</span> <span class="o">=</span> <span class="n">vel_corr_time2</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">time_tr1</span><span class="p">,</span> <span class="n">disp_tr1</span><span class="p">,</span> <span class="n">mean_disp_tr1</span><span class="p">,</span> <span class="n">sigma_tr1</span> <span class="o">=</span> <span class="n">calc_residual_disp</span><span class="p">(</span><span class="n">tr1_new</span><span class="p">,</span> <span class="n">on</span><span class="p">,</span> <span class="n">off</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>

<span class="n">time_tr2</span><span class="p">,</span> <span class="n">disp_tr2</span><span class="p">,</span> <span class="n">mean_disp_tr2</span><span class="p">,</span> <span class="n">sigma_tr2</span> <span class="o">=</span> <span class="n">calc_residual_disp</span><span class="p">(</span><span class="n">tr2_new</span><span class="p">,</span> <span class="n">on</span><span class="p">,</span> <span class="n">off</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>

<span class="n">time_tt</span><span class="p">,</span> <span class="n">disp_tt</span><span class="p">,</span> <span class="n">mean_disp_tt</span><span class="p">,</span> <span class="n">sigma_tt</span> <span class="o">=</span> <span class="n">calc_residual_disp</span><span class="p">(</span><span class="n">tt_new</span><span class="p">,</span> <span class="n">on</span><span class="p">,</span> <span class="n">off</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>

<span class="n">time_tt2</span><span class="p">,</span> <span class="n">disp_tt2</span><span class="p">,</span> <span class="n">mean_disp_tt2</span><span class="p">,</span> <span class="n">sigma_tt2</span> <span class="o">=</span> <span class="n">calc_residual_disp</span><span class="p">(</span><span class="n">tt2_new</span><span class="p">,</span> <span class="n">on</span><span class="p">,</span> <span class="n">off</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
</pre></div>
</div>
<p>calculate the position of the seismometer mass</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">h_tr1</span><span class="p">,</span> <span class="n">std_tr1</span> <span class="o">=</span> <span class="n">calc_height_of_mass</span><span class="p">(</span><span class="n">mean_disp_tr1</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">dh</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>
<span class="n">h_tr2</span><span class="p">,</span> <span class="n">std_tr2</span> <span class="o">=</span> <span class="n">calc_height_of_mass</span><span class="p">(</span><span class="n">mean_disp_tr2</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">dh</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>
<span class="n">h_tt</span><span class="p">,</span> <span class="n">std_tt</span> <span class="o">=</span> <span class="n">calc_height_of_mass</span><span class="p">(</span><span class="n">mean_disp_tt</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">dh</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>

<span class="n">disp_corr_freq1</span> <span class="o">=</span> <span class="n">vel_corr_freq1</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">disp_corr_freq1</span><span class="o">.</span><span class="n">integrate</span><span class="p">()</span>

<span class="n">disp_corr_freq2</span> <span class="o">=</span> <span class="n">vel_corr_freq2</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">disp_corr_freq2</span><span class="o">.</span><span class="n">integrate</span><span class="p">()</span>

<span class="n">disp_corr_time</span> <span class="o">=</span> <span class="n">vel_corr_time</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">disp_corr_time</span><span class="o">.</span><span class="n">integrate</span><span class="p">()</span>

<span class="n">disp_corr_time2</span> <span class="o">=</span> <span class="n">vel_corr_time2</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">disp_corr_time2</span><span class="o">.</span><span class="n">integrate</span><span class="p">()</span>

<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># OUTPUT</span>
<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="n">scale</span> <span class="o">=</span> <span class="mf">1.0e3</span>
<span class="n">scaled</span> <span class="o">=</span> <span class="mf">1.0e6</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-----------------------------------------------&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;mean residual displacement:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;frequency domain (coh): </span><span class="si">%.3f</span><span class="s2"> +/- </span><span class="si">%.3f</span><span class="s2"> mm&quot;</span>
    <span class="o">%</span> <span class="p">(</span><span class="n">mean_disp_tr1</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span> <span class="n">sigma_tr1</span> <span class="o">*</span> <span class="n">scale</span><span class="p">)</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;frequency domain (CaW): </span><span class="si">%.3f</span><span class="s2"> +/- </span><span class="si">%.3f</span><span class="s2"> mm&quot;</span>
    <span class="o">%</span> <span class="p">(</span><span class="n">mean_disp_tr2</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span> <span class="n">sigma_tr2</span> <span class="o">*</span> <span class="n">scale</span><span class="p">)</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;time domain           : </span><span class="si">%.3f</span><span class="s2"> +/- </span><span class="si">%.3f</span><span class="s2"> mm&quot;</span>
    <span class="o">%</span> <span class="p">(</span><span class="n">mean_disp_tt</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span> <span class="n">sigma_tt</span> <span class="o">*</span> <span class="n">scale</span><span class="p">)</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-----------------------------------------------&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;height of seismometer mass:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;frequency domain (coh): </span><span class="si">%.3f</span><span class="s2"> +/- </span><span class="si">%.3f</span><span class="s2"> mm&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">h_tr1</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span> <span class="n">std_tr1</span> <span class="o">*</span> <span class="n">scale</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;frequency domain (CaW): </span><span class="si">%.3f</span><span class="s2"> +/- </span><span class="si">%.3f</span><span class="s2"> mm&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">h_tr2</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span> <span class="n">std_tr2</span> <span class="o">*</span> <span class="n">scale</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;time domain           : </span><span class="si">%.3f</span><span class="s2"> +/- </span><span class="si">%.3f</span><span class="s2"> mm&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">h_tt</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span> <span class="n">std_tt</span> <span class="o">*</span> <span class="n">scale</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;theoretical           : </span><span class="si">%.3f</span><span class="s2"> +/- </span><span class="si">%.3f</span><span class="s2"> mm&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">h_ttheo</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span> <span class="n">std_ttheo</span> <span class="o">*</span> <span class="n">scale</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;measured              : </span><span class="si">%.3f</span><span class="s2"> +/- </span><span class="si">%.3f</span><span class="s2"> mm&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">h_m</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span> <span class="n">std_m</span> <span class="o">*</span> <span class="n">scale</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-----------------------------------------------&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>-----------------------------------------------
mean residual displacement:
frequency domain (coh): 0.042 +/- 0.005 mm
frequency domain (CaW): 0.016 +/- 0.002 mm
time domain           : 0.042 +/- 0.005 mm

-----------------------------------------------
height of seismometer mass:
frequency domain (coh): 57.400 +/- 0.235 mm
frequency domain (CaW): -6.458 +/- 0.091 mm
time domain           : 57.400 +/- 0.235 mm
theoretical           : 57.161 +/- 0.234 mm
measured              : 57.500 +/- 10.000 mm
-----------------------------------------------
</pre></div>
</div>
</div>
<div class="section" id="plots">
<h2>Plots<a class="headerlink" href="#plots" title="Permalink to this headline">Â¶</a></h2>
<p>Uncomment the following lines in case you want to use latex for type setting</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># params = {</span>
<span class="c1">#     &#39;text.usetex&#39;: True,</span>
<span class="c1">#     &#39;text.latex.preamble&#39;: [</span>
<span class="c1">#         r&#39;\usepackage{cmbright}&#39;, r&#39;\usepackage{amsmath}&#39;]}</span>
<span class="c1"># plt.rcParams.update(params)</span>
<a href="https://matplotlib.org/stable/api/matplotlib_configuration_api.html#matplotlib.rcParams" title="matplotlib.rcParams" class="sphx-glr-backref-module-matplotlib sphx-glr-backref-type-py-data"><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span></a><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">7.1</span><span class="p">,</span> <span class="mf">9.6</span>
<span class="n">sizeOfFont</span> <span class="o">=</span> <span class="mi">12</span>
<span class="n">fontProperties</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;weight&quot;</span><span class="p">:</span> <span class="s2">&quot;normal&quot;</span><span class="p">,</span> <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="n">sizeOfFont</span><span class="p">}</span>
<a href="https://matplotlib.org/stable/api/matplotlib_configuration_api.html#matplotlib.rc" title="matplotlib.rc" class="sphx-glr-backref-module-matplotlib sphx-glr-backref-type-py-function"><span class="n">rc</span></a><span class="p">(</span><span class="s2">&quot;font&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">fontProperties</span><span class="p">)</span>

<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># colors and linestyles</span>
<span class="c1"># define colors</span>
<span class="n">al_trig</span> <span class="o">=</span> <span class="mf">0.1</span>

<span class="n">c_trig_on</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">c_trig_off</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">c_angle</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">c_vel</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">c_time</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">c_time2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">c_coh</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.54</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">c_freq</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">c_tdisp</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1"># define linestyles</span>
<span class="n">ls_trig_on</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span>
<span class="n">ls_trig_off</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span>

<span class="n">ls_angle</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span>
<span class="n">ls_vel</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span>

<span class="n">ls_time</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span>
<span class="n">ls_time2</span> <span class="o">=</span> <span class="s2">&quot;--&quot;</span>
<span class="n">ls_coh</span> <span class="o">=</span> <span class="s2">&quot;--&quot;</span>
<span class="n">ls_freq</span> <span class="o">=</span> <span class="s2">&quot;:&quot;</span>

<span class="n">ls_tdisp</span> <span class="o">=</span> <span class="s2">&quot;:&quot;</span>

<span class="c1"># define linewidth</span>
<span class="n">lw_trig_on</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="n">lw_trig_off</span> <span class="o">=</span> <span class="mf">2.0</span>

<span class="n">lw_angle</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="n">lw_vel</span> <span class="o">=</span> <span class="mf">2.0</span>

<span class="n">lw_time</span> <span class="o">=</span> <span class="mf">1.5</span>
<span class="n">lw_time2</span> <span class="o">=</span> <span class="mf">1.5</span>
<span class="n">lw_coh</span> <span class="o">=</span> <span class="mf">2.5</span>
<span class="n">lw_freq</span> <span class="o">=</span> <span class="mf">2.5</span>

<span class="n">lw_tdisp</span> <span class="o">=</span> <span class="mf">2.0</span>

<span class="c1"># define labels</span>
<span class="n">l_trig</span> <span class="o">=</span> <span class="s2">&quot;step table movement&quot;</span>

<span class="n">l_angle</span> <span class="o">=</span> <span class="s2">&quot;tilt angle&quot;</span>
<span class="n">l_vel</span> <span class="o">=</span> <span class="s2">&quot;NOT corrected&quot;</span>

<span class="n">l_time</span> <span class="o">=</span> <span class="s2">&quot;corr. time domain&quot;</span>
<span class="n">l_time2</span> <span class="o">=</span> <span class="s2">&quot;corr. time domain with disp&quot;</span>
<span class="n">l_coh</span> <span class="o">=</span> <span class="s2">&quot;corr. frequency domain (adapted)&quot;</span>
<span class="n">l_freq</span> <span class="o">=</span> <span class="s2">&quot;corr. frequency domain (CaW2000)&quot;</span>

<span class="n">l_tdisp</span> <span class="o">=</span> <span class="s2">&quot;theo. displacement&quot;</span>
<span class="c1"># END colors and linestyles</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gridspec</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.subplots.html#matplotlib.pyplot.subplots" title="matplotlib.pyplot.subplots" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span></a><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">gridspec_kw</span><span class="o">=</span><span class="n">gridspec</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

<span class="n">ax0</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">ax3</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
<span class="n">ax31</span> <span class="o">=</span> <span class="n">ax3</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
<span class="n">ax4</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>

<span class="p">(</span><span class="n">line_angle</span><span class="p">,)</span> <span class="o">=</span> <span class="n">ax0</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">sec</span><span class="p">,</span>
    <span class="n">ts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">c_angle</span><span class="p">,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="n">ls_angle</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="n">lw_angle</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="n">l_angle</span><span class="p">,</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">on</span><span class="p">)):</span>
    <span class="n">p_trig</span> <span class="o">=</span> <span class="n">ax0</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="n">on</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">off</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="n">al_trig</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">c_trig_on</span><span class="p">)</span>

<span class="p">(</span><span class="n">line_vel</span><span class="p">,)</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">sec</span><span class="p">,</span>
    <span class="n">vel_orig</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">c_vel</span><span class="p">,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="n">ls_vel</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="n">lw_vel</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="n">l_vel</span><span class="p">,</span>
<span class="p">)</span>

<span class="p">(</span><span class="n">line_time</span><span class="p">,)</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">sec</span><span class="p">,</span>
    <span class="n">tt_vel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">c_time</span><span class="p">,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="n">ls_time</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="n">lw_time</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="n">l_time</span><span class="p">,</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">on</span><span class="p">)):</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="n">on</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">off</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="n">al_trig</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">c_trig_on</span><span class="p">)</span>

<span class="p">(</span><span class="n">line_angle</span><span class="p">,)</span> <span class="o">=</span> <span class="n">ax31</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">sec</span><span class="p">,</span>
    <span class="n">ts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">c_angle</span><span class="p">,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="n">ls_angle</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="n">lw_angle</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="n">l_angle</span><span class="p">,</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">on</span><span class="p">)):</span>
    <span class="n">p_trig</span> <span class="o">=</span> <span class="n">ax31</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="n">on</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">off</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="n">al_trig</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">c_trig_on</span><span class="p">)</span>

<span class="p">(</span><span class="n">line_time</span><span class="p">,)</span> <span class="o">=</span> <span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">sec</span><span class="p">,</span>
    <span class="n">tt_vel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">c_time</span><span class="p">,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="n">ls_time</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="n">lw_time</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="n">l_time</span><span class="p">,</span>
<span class="p">)</span>

<span class="p">(</span><span class="n">line_coh</span><span class="p">,)</span> <span class="o">=</span> <span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">sec</span><span class="p">,</span>
    <span class="n">tr1_vel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">c_coh</span><span class="p">,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="n">ls_coh</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="n">lw_coh</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="n">l_coh</span><span class="p">,</span>
<span class="p">)</span>

<span class="p">(</span><span class="n">line_freq</span><span class="p">,)</span> <span class="o">=</span> <span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">sec</span><span class="p">,</span>
    <span class="n">tr2_vel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">c_freq</span><span class="p">,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="n">ls_freq</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="n">lw_freq</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="n">l_freq</span><span class="p">,</span>
<span class="p">)</span>

<span class="p">(</span><span class="n">line_time2</span><span class="p">,)</span> <span class="o">=</span> <span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">sec</span><span class="p">,</span>
    <span class="n">vel_corr_time2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">c_time2</span><span class="p">,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="n">ls_time2</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="n">lw_time2</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="n">l_time2</span><span class="p">,</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">on</span><span class="p">)):</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="n">on</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">off</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="n">al_trig</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">c_trig_on</span><span class="p">)</span>

    <span class="p">(</span><span class="n">line_time_d</span><span class="p">,)</span> <span class="o">=</span> <span class="n">ax4</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">time_tt</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
        <span class="n">disp_tt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">scaled</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="n">c_time</span><span class="p">,</span>
        <span class="n">linestyle</span><span class="o">=</span><span class="n">ls_time</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="n">lw_time</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="n">l_time</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="p">(</span><span class="n">line_coh_d</span><span class="p">,)</span> <span class="o">=</span> <span class="n">ax4</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">time_tr1</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
        <span class="n">disp_tr1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">scaled</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="n">c_coh</span><span class="p">,</span>
        <span class="n">linestyle</span><span class="o">=</span><span class="n">ls_coh</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="n">lw_coh</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="n">l_coh</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="p">(</span><span class="n">line_freq_d</span><span class="p">,)</span> <span class="o">=</span> <span class="n">ax4</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">time_tr2</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
        <span class="n">disp_tr2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">scaled</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="n">c_freq</span><span class="p">,</span>
        <span class="n">linestyle</span><span class="o">=</span><span class="n">ls_freq</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="n">lw_freq</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="n">l_freq</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="p">(</span><span class="n">line_time_d2</span><span class="p">,)</span> <span class="o">=</span> <span class="n">ax4</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">time_tt2</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
        <span class="n">disp_tt2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">scaled</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="n">c_time2</span><span class="p">,</span>
        <span class="n">linestyle</span><span class="o">=</span><span class="n">ls_time2</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="n">lw_time2</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="n">l_time2</span><span class="p">,</span>
    <span class="p">)</span>

<span class="p">(</span><span class="n">line_theo_d</span><span class="p">,)</span> <span class="o">=</span> <span class="n">ax4</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">sec</span><span class="p">,</span> <span class="n">r</span> <span class="o">*</span> <span class="n">scaled</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">c_tdisp</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">ls_tdisp</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">l_tdisp</span>
<span class="p">)</span>

<span class="n">ax0</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;rotation angle [mrad]&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">c_angle</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;velocity [mm/s]&quot;</span><span class="p">)</span>

<span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;velocity [mm/s]&quot;</span><span class="p">)</span>
<span class="n">ax31</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;rotation angle [mrad]&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">c_angle</span><span class="p">)</span>

<span class="n">ax4</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;displacement [mum]&quot;</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;time [s]&quot;</span><span class="p">)</span>

<span class="n">ax0</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">c_angle</span><span class="p">)</span>
<span class="n">ax31</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">c_angle</span><span class="p">)</span>

<span class="n">ax0</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="s2">&quot;in&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="s2">&quot;in&quot;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="s2">&quot;in&quot;</span><span class="p">)</span>
<span class="n">ax31</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="s2">&quot;in&quot;</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="s2">&quot;in&quot;</span><span class="p">)</span>

<span class="n">ax0</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
<span class="n">ax31</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>

<span class="n">ax0</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mi">16</span><span class="p">,</span> <span class="mf">0.26</span><span class="p">,</span> <span class="s2">&quot;(a)&quot;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">53.32</span><span class="p">,</span> <span class="mf">0.13</span><span class="p">,</span> <span class="s2">&quot;(b)&quot;</span><span class="p">)</span>

<span class="c1"># legend</span>
<span class="n">ba</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.098</span><span class="p">,</span> <span class="mf">3.2</span><span class="p">)</span>
<span class="n">lines</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">p_trig</span><span class="p">,</span>
    <span class="n">line_angle</span><span class="p">,</span>
    <span class="n">line_vel</span><span class="p">,</span>
    <span class="n">line_theo_d</span><span class="p">,</span>
    <span class="n">line_coh</span><span class="p">,</span>
    <span class="n">line_freq</span><span class="p">,</span>
    <span class="n">line_time</span><span class="p">,</span>
    <span class="n">line_time2</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">(</span><span class="n">l_trig</span><span class="p">,</span> <span class="n">l_angle</span><span class="p">,</span> <span class="n">l_vel</span><span class="p">,</span> <span class="n">l_tdisp</span><span class="p">,</span> <span class="n">l_coh</span><span class="p">,</span> <span class="n">l_freq</span><span class="p">,</span> <span class="n">l_time</span><span class="p">,</span> <span class="n">l_time2</span><span class="p">)</span>
<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.legend.html#matplotlib.pyplot.legend" title="matplotlib.pyplot.legend" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">legend</span></a><span class="p">(</span>
    <span class="n">lines</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">ba</span><span class="p">,</span> <span class="n">bbox_transform</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">borderaxespad</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">2</span>
<span class="p">)</span>

<span class="n">ax0</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">zoom00</span><span class="p">,</span> <span class="n">zoom01</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">zoom00</span><span class="p">,</span> <span class="n">zoom01</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">zoom0</span><span class="p">,</span> <span class="n">zoom1</span><span class="p">)</span>
<span class="n">ax31</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">zoom0</span><span class="p">,</span> <span class="n">zoom1</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">zoom0</span><span class="p">,</span> <span class="n">zoom1</span><span class="p">)</span>

<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.subplots_adjust.html#matplotlib.pyplot.subplots_adjust" title="matplotlib.pyplot.subplots_adjust" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span></a><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.868</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.053</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="mf">0.118</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">0.88</span><span class="p">)</span>

<span class="n">zoom_effect01</span><span class="p">(</span><span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">,</span> <span class="mf">54.16</span><span class="p">,</span> <span class="mf">55.00</span><span class="p">)</span>

<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.gcf.html#matplotlib.pyplot.gcf" title="matplotlib.pyplot.gcf" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">gcf</span></a><span class="p">()</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;tilt_correction_step_table.png&quot;</span><span class="p">)</span>

<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.show.html#matplotlib.pyplot.show" title="matplotlib.pyplot.show" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">show</span></a><span class="p">()</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_tilt_001.png" srcset="../_images/sphx_glr_tilt_001.png" alt="tilt" class = "sphx-glr-single-img"/><p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  1.675 seconds)</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-examples-tilt-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../_downloads/ac71ac78276f0dde8b082a2efb7b85ca/tilt.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">tilt.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../_downloads/b0e60644665185967da6231eb778ca31/tilt.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">tilt.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</div>
</div>


              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="dispersion.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Six-component dispersion analysis</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../contributing.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Contributing</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
        &copy; Copyright 2022, The TwistPy Developers.<br/>
      Last updated on Dec 09, 2022.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-MYGG4BF95D"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-MYGG4BF95D');
</script>

  </body>
</html>